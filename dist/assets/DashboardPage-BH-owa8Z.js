import{r as b,j as e,M as D}from"./index-CsrQR31d.js";import{T as A,G as K}from"./index-Ce2_9GLb.js";const L=["Phù hợp JD (Job Fit)","Kinh nghiệm","Kỹ năng","Thành tựu/KPI","Học vấn","Ngôn ngữ","Chuyên nghiệp","Gắn bó & Lịch sử CV","Phù hợp văn hoá"],J={"Phù hợp JD (Job Fit)":{icon:"fa-solid fa-bullseye",color:"text-sky-400"},"Kinh nghiệm":{icon:"fa-solid fa-briefcase",color:"text-green-400"},"Kỹ năng":{icon:"fa-solid fa-gears",color:"text-purple-400"},"Thành tựu/KPI":{icon:"fa-solid fa-trophy",color:"text-yellow-400"},"Học vấn":{icon:"fa-solid fa-graduation-cap",color:"text-indigo-400"},"Ngôn ngữ":{icon:"fa-solid fa-language",color:"text-orange-400"},"Chuyên nghiệp":{icon:"fa-solid fa-file-invoice",color:"text-cyan-400"},"Gắn bó & Lịch sử CV":{icon:"fa-solid fa-hourglass-half",color:"text-lime-400"},"Phù hợp văn hoá":{icon:"fa-solid fa-users-gear",color:"text-pink-400"}},U=({item:n,isExpanded:r,onToggle:o})=>{const[h,i]=b.useState(!1),c=b.useMemo(()=>{const f=n.Điểm.match(/(\d+)\/(\d+)/),k=f?parseInt(f[1],10):0,p=n["Công thức"].match(/subscore ([\d.]+)/),$=p?parseFloat(p[1]):null,N=n["Công thức"].match(/trọng số ([\d]+)%/),v=N?parseInt(N[1],10):null,t=n["Công thức"].match(/= (.*)$/),s=t?t[1].trim():"";return{score:k,subscore:$,weight:v,formulaResult:s}},[n]),g=f=>f>=85?"bg-emerald-500/20 text-emerald-300 border-emerald-500/30":f>=70?"bg-yellow-500/20 text-yellow-300 border-yellow-500/30":"bg-red-500/20 text-red-300 border-red-500/30",m=()=>{navigator.clipboard.writeText(n["Dẫn chứng"]),i(!0),setTimeout(()=>i(!1),2e3)},C=J[n["Tiêu chí"]]||{icon:"fa-solid fa-question-circle",color:"text-slate-400"};return e.jsxs("div",{className:"bg-slate-800/50 rounded-2xl border border-slate-700/80 shadow-sm transition-all duration-200 hover:shadow-lg hover:border-blue-600/60",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-4 h-[64px] text-left",onClick:o,"aria-expanded":r,"aria-controls":`accordion-content-${n["Tiêu chí"].replace(/\s/g,"")}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("i",{className:`${C.icon} ${C.color} w-5 text-center text-lg`}),e.jsx("span",{className:"font-semibold text-slate-200",children:n["Tiêu chí"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[c.subscore!==null&&e.jsxs("span",{className:"hidden md:inline-block text-xs font-semibold bg-slate-700/80 text-slate-300 px-2.5 py-1 rounded-full",children:["subscore ",c.subscore]}),c.weight!==null&&e.jsxs("span",{className:"hidden md:inline-block text-xs font-semibold bg-slate-700/80 text-slate-300 px-2.5 py-1 rounded-full",children:[c.weight,"%"]}),e.jsxs("span",{className:`text-base font-bold px-3 py-1.5 rounded-lg text-white ${g(c.score).replace(/text-\w+-\d+/,"").replace("border-transparent","")}`,children:[c.score,e.jsx("span",{className:"text-xs text-slate-400",children:"/100"})]}),e.jsx("i",{className:`fa-solid fa-chevron-down text-slate-400 transition-transform duration-300 ${r?"rotate-180":""}`})]})]}),r&&e.jsx("div",{id:`accordion-content-${n["Tiêu chí"].replace(/\s/g,"")}`,className:"px-4 pb-4 pt-2 border-t border-slate-700/50",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300",children:"Dẫn chứng (trích từ CV)"}),e.jsxs("button",{onClick:m,className:"text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1.5",children:[e.jsx("i",{className:`fa-solid ${h?"fa-check text-emerald-400":"fa-copy"}`}),h?"Đã chép":"Chép"]})]}),e.jsx("blockquote",{className:"text-sm text-slate-400 italic border-l-2 border-blue-500 pl-3 leading-relaxed",children:n["Dẫn chứng"]==="Không tìm thấy thông tin trong CV"?e.jsx("span",{className:"not-italic bg-yellow-500/10 text-yellow-400 px-2 py-1 rounded-md text-xs font-semibold",children:"Chưa tìm thấy trong CV"}):n["Dẫn chứng"]})]}),e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Giải thích & Công thức"}),e.jsx("p",{className:"text-sm text-slate-400 leading-relaxed mb-2",children:n["Giải thích"]}),e.jsxs("p",{className:"font-mono text-xs bg-slate-800 text-slate-400 p-2 rounded-md",children:[e.jsxs("span",{className:"text-cyan-400",children:["subscore ",c.subscore??"N/A"]})," ×",e.jsxs("span",{className:"text-purple-400",children:[" trọng số ",c.weight??"N/A","%"]})," =",e.jsxs("span",{className:"text-yellow-400",children:[" ",c.formulaResult||"N/A"]})]})]})]})})]})},Q=({candidate:n,rank:r})=>{const[o,h]=b.useState(!1),[i,c]=b.useState({}),{candidateName:g,phone:m,email:C,fileName:f,jobTitle:k,status:p,error:$,experienceLevel:N,hardFilterFailureReason:v,softFilterWarnings:t,analysis:s}=n,l=p==="FAILED",u=(s==null?void 0:s.Hạng)||"C",w=(s==null?void 0:s["Tổng điểm"])||0,j=s==null?void 0:s["Điểm mạnh CV"],a=s==null?void 0:s["Điểm yếu CV"],x=l?"bg-slate-600":u==="A"?"bg-emerald-600":u==="B"?"bg-blue-600":"bg-red-600",S=l?"text-slate-400":u==="A"?"text-emerald-400":u==="B"?"text-blue-400":"text-red-400",T=b.useMemo(()=>{var d;return(d=s==null?void 0:s["Chi tiết"])==null?void 0:d.find(y=>y["Tiêu chí"].startsWith("Phù hợp JD"))},[s]),I=T?parseInt(T.Điểm.split("/")[0],10):0,H=d=>d>=80?"bg-green-500/20 text-green-300":d>=60?"bg-yellow-500/20 text-yellow-300":"bg-red-500/20 text-red-300",E=l?"bg-slate-700/60 text-slate-400":H(w),P=l?"bg-slate-700/60 text-slate-400":H(I),V=b.useMemo(()=>s?[...s["Chi tiết"]].sort((d,y)=>L.indexOf(d["Tiêu chí"])-L.indexOf(y["Tiêu chí"])):[],[s]),M=d=>{c(y=>({...y,[d]:!y[d]}))},B=()=>{const d=V.every(R=>i[R["Tiêu chí"]]),y={};V.forEach(R=>{y[R["Tiêu chí"]]=!d}),c(y)};return e.jsxs("div",{className:"candidate-card bg-slate-800/70 border border-slate-700 rounded-2xl shadow-sm transition-all duration-300 hover:shadow-2xl hover:border-blue-600 backdrop-blur-sm",children:[e.jsxs("div",{className:"p-4 cursor-pointer",onClick:()=>h(!o),"aria-expanded":o,children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[e.jsxs("div",{title:"Thứ tự xếp hạng",className:`flex-shrink-0 w-9 h-9 sm:w-10 sm:h-10 flex items-center justify-center text-base font-bold rounded-full text-white ${x}`,children:["#",r]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-lg font-bold text-slate-100 truncate",children:g||"Chưa xác định"}),e.jsxs("p",{className:"text-sm text-slate-400 truncate",children:[!l&&e.jsx("span",{className:`font-bold ${S}`,children:`Hạng ${u}`}),k&&e.jsxs("span",{className:"hidden sm:inline",children:[" • ",k]}),N&&e.jsxs("span",{className:"hidden sm:inline font-normal text-slate-500",children:[" • ",N]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1 font-medium",children:"Phù hợp JD"}),e.jsx("span",{className:`text-lg font-bold px-3 py-1 rounded-md ${P}`,children:l?"--":`${I}%`})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-1 font-medium",children:"Điểm Tổng"}),e.jsx("span",{className:`text-lg font-bold px-3 py-1 rounded-md ${E}`,children:l?"--":w})]})]}),e.jsxs("button",{className:"text-blue-400 font-semibold hover:text-blue-300 flex items-center gap-2",children:[e.jsx("span",{className:"hidden sm:inline",children:"Chi Tiết"}),e.jsx("i",{className:`fa-solid fa-chevron-down transition-transform duration-300 ${o?"rotate-180":""}`})]})]}),l&&e.jsxs("p",{className:"text-sm font-semibold text-rose-400 mt-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-circle-xmark"}),"Lỗi: ",$||"Không xác định"]})]}),o&&!l&&s&&e.jsxs("div",{className:"border-t border-slate-700/80 p-4 md:p-6 bg-slate-900/40 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[j&&j.length>0&&e.jsxs("div",{className:"p-4 bg-green-900/30 border border-green-500/30 rounded-xl",children:[e.jsxs("p",{className:"font-semibold text-green-300 mb-2 flex items-center gap-2 text-base",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles"}),"Điểm mạnh CV"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-green-400/90 space-y-1.5 pl-2",children:j.map((d,y)=>e.jsx("li",{children:d},y))})]}),a&&a.length>0&&e.jsxs("div",{className:"p-4 bg-red-900/30 border border-red-500/30 rounded-xl",children:[e.jsxs("p",{className:"font-semibold text-red-300 mb-2 flex items-center gap-2 text-base",children:[e.jsx("i",{className:"fa-solid fa-flag"}),"Điểm yếu CV"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-400/90 space-y-1.5 pl-2",children:a.map((d,y)=>e.jsx("li",{children:d},y))})]})]}),t&&t.length>0&&e.jsxs("div",{className:"p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg text-sm",children:[e.jsxs("p",{className:"font-semibold text-yellow-300 mb-1 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-triangle-exclamation"}),"Lưu ý Thêm"]}),e.jsx("ul",{className:"list-disc list-inside text-yellow-400 space-y-1 pl-2",children:t.map((d,y)=>e.jsx("li",{children:d},y))})]}),v&&e.jsxs("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded-lg text-sm",children:[e.jsxs("p",{className:"font-semibold text-red-300 mb-1 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-ban"}),"Không Đạt Yêu Cầu Bắt Buộc"]}),e.jsx("p",{className:"text-red-400",children:v})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-xl font-bold text-slate-100",children:"Chi tiết Chấm điểm"}),e.jsx("button",{onClick:B,className:"text-sm font-semibold text-blue-400 hover:text-blue-300",children:V.every(d=>i[d["Tiêu chí"]])?"Thu gọn tất cả":"Mở rộng tất cả"})]}),e.jsx("div",{className:"space-y-3",children:V.map(d=>e.jsx(U,{item:d,isExpanded:!!i[d["Tiêu chí"]],onToggle:()=>M(d["Tiêu chí"])},d["Tiêu chí"]))})]}),e.jsxs("div",{className:"text-xs text-slate-500 text-right pt-4 border-t border-slate-700/50",children:[e.jsxs("p",{className:"mb-1",children:["Liên hệ: ",m||"N/A"," • ",C||"N/A"]}),e.jsxs("p",{children:["Nguồn CV: ",f||"N/A"]})]})]})]})};let G=null,q=0;const F=["AIzaSyCbDnp1aAtByJYMRFlVQBKMtPtvqpFDtgs","AIzaSyCJQcFwaYI0GyTIjJDMAc0yLL0MQ-WsbjU","AIzaSyB6ptOgRHW2PnRNxJ8ZHxT0KLF_5X6giKQ","AIzaSyDxq8P2AgiIUqQNZttMcrCh6yjTVutbq9E"].filter(Boolean);function O(){if(!G){if(F.length===0)throw new Error("No GEMINI_API_KEY environment variables set.");const n=F[q];if(!n)throw new Error("API_KEY environment variable not set.");G=new K({apiKey:n})}return G}function Y(){q=(q+1)%F.length,G=null}async function W(n,r,o){for(let h=0;h<F.length;h++)try{return await O().models.generateContent({model:n,contents:r,config:o})}catch(i){console.warn(`API key ${q+1} failed:`,i),Y()}throw new Error("All API keys failed. Please check your API keys and quota.")}const _={type:A.OBJECT,properties:{questionSets:{type:A.ARRAY,items:{type:A.OBJECT,properties:{category:{type:A.STRING,description:"Tên danh mục câu hỏi"},icon:{type:A.STRING,description:"Font Awesome icon class"},color:{type:A.STRING,description:"Tailwind color class"},questions:{type:A.ARRAY,items:{type:A.STRING},description:"Danh sách câu hỏi trong danh mục"}},required:["category","icon","color","questions"]}}},required:["questionSets"]},z=async(n,r,o,h)=>{let i="";if(o==="general")i=X(n,r);else if(o==="specific"&&h&&!Array.isArray(h))i=Z(n,r,h);else if(o==="comparative"&&Array.isArray(h))i=ee(n,r,h);else throw new Error("Invalid question type or candidate data");try{const c=await W(D,i,{responseMimeType:"application/json",responseSchema:_,temperature:.3,topP:.8,topK:40});return JSON.parse(c.text).questionSets||[]}catch(c){throw console.error("Error generating interview questions:",c),c}},X=(n,r)=>`
Bạn là chuyên gia tuyển dụng với 15+ năm kinh nghiệm. Nhiệm vụ: Tạo câu hỏi phỏng vấn thông minh dựa trên dữ liệu thực tế.

**THÔNG TIN TUYỂN DỤNG:**
- Vị trí: ${r.jobPosition}
- Địa điểm: ${n.job.locationRequirement}
- Tổng ứng viên đã lọc: ${r.totalCandidates}
- Ngành nghề chính: ${r.industries.join(", ")}
- Cấp độ phổ biến: ${r.levels.join(", ")}

**ĐIỂM YẾU PHỔ BIẾN CỦA ỨNG VIÊN:**
${r.commonWeaknesses.length>0?r.commonWeaknesses.map((o,h)=>`${h+1}. ${o}`).join(`
`):"Không có dữ liệu đặc biệt"}

**KỸ NĂNG THIẾU PHỔ BIẾN:**
${r.skillGaps.length>0?r.skillGaps.map((o,h)=>`${h+1}. ${o}`).join(`
`):"Không có dữ liệu đặc biệt"}

**YÊU CẦU:**
1. Tạo 4-5 nhóm câu hỏi khác nhau
2. Mỗi nhóm 4-6 câu hỏi cụ thể, thực tế
3. Câu hỏi PHẢI dựa trên dữ liệu thực tế về điểm yếu và kỹ năng thiếu
4. Tránh câu hỏi chung chung, tập trung vào những vấn đề cụ thể từ việc lọc CV
5. Bao gồm cả câu hỏi kỹ thuật và soft skills
6. Câu hỏi phải phù hợp với vị trí ${r.jobPosition}

**NHÓM GỢI Ý:**
- Câu hỏi chuyên môn theo vị trí và ngành nghề
- Câu hỏi về những điểm yếu phổ biến đã phát hiện
- Câu hỏi đánh giá kỹ năng thiếu
- Câu hỏi tình huống thực tế
- Câu hỏi về cultural fit và growth mindset

Trả về JSON với format yêu cầu. Icon sử dụng Font Awesome classes, color sử dụng Tailwind classes.
`,Z=(n,r,o)=>{var C,f,k,p,$;const h=((C=o.analysis)==null?void 0:C["Điểm mạnh CV"])||[],i=((f=o.analysis)==null?void 0:f["Điểm yếu CV"])||[],c=((k=o.analysis)==null?void 0:k["Chi tiết"])||[],g=[],m=[];return c.forEach(N=>{const v=parseFloat(N.Điểm.split("/")[0]),t=parseFloat(N.Điểm.split("/")[1]),s=v/t*100;s>=80?g.push(N["Tiêu chí"]):s<50&&m.push(N["Tiêu chí"])}),`
Bạn là chuyên gia tuyển dụng. Tạo câu hỏi phỏng vấn CỤ THỂ cho ứng viên này dựa trên phân tích CV chi tiết.

**THÔNG TIN VỊ TRÍ:**
- Vị trí: ${r.jobPosition}
- Địa điểm: ${n.job.locationRequirement}

**THÔNG TIN ỨNG VIÊN:**
- Tên: ${o.candidateName}
- Chức danh hiện tại: ${o.jobTitle}
- Ngành: ${o.industry}
- Cấp độ: ${o.experienceLevel}
- Điểm tổng: ${(p=o.analysis)==null?void 0:p["Tổng điểm"]}/100
- Hạng: ${($=o.analysis)==null?void 0:$.Hạng}

**ĐIỂM MẠNH CỦA ỨNG VIÊN:**
${h.length>0?h.map((N,v)=>`${v+1}. ${N}`).join(`
`):"Chưa xác định"}

**ĐIỂM YẾU CỦA ỨNG VIÊN:**
${i.length>0?i.map((N,v)=>`${v+1}. ${N}`).join(`
`):"Chưa xác định"}

**LĨNH VỰC MẠNH (điểm >=80%):**
${g.length>0?g.join(", "):"Không có"}

**LĨNH VỰC YẾU (điểm <50%):**
${m.length>0?m.join(", "):"Không có"}

**YÊU CẦU:**
1. Tạo câu hỏi RIÊNG BIỆT cho ứng viên này, không phải template chung
2. Khai thác sâu vào điểm mạnh để xác nhận
3. Thách thức những điểm yếu để test khả năng
4. Câu hỏi phải cụ thể, có thể verify được qua câu trả lời
5. Bao gồm câu hỏi tình huống dựa trên background của ứng viên
6. Tập trung vào việc validate những gì đã thể hiện trong CV

**NHÓM CÂUHỎI GỢI Ý:**
- Xác nhận điểm mạnh và kinh nghiệm
- Thách thức điểm yếu đã phát hiện  
- Câu hỏi kỹ thuật theo chuyên môn
- Tình huống thực tế trong vai trò ${r.jobPosition}
- Câu hỏi về growth và learning ability

Mỗi nhóm 4-5 câu cụ thể. Trả về JSON format.
`},ee=(n,r,o)=>{const h=o.map(i=>{var c,g,m,C;return{name:i.candidateName,rank:(c=i.analysis)==null?void 0:c.Hạng,score:(g=i.analysis)==null?void 0:g["Tổng điểm"],title:i.jobTitle,level:i.experienceLevel,strengths:((m=i.analysis)==null?void 0:m["Điểm mạnh CV"])||[],weaknesses:((C=i.analysis)==null?void 0:C["Điểm yếu CV"])||[]}});return`
Bạn là chuyên gia tuyển dụng. Tạo câu hỏi để SO SÁNH và lựa chọn giữa các ứng viên tốt nhất.

**THÔNG TIN VỊ TRÍ:**
- Vị trí: ${r.jobPosition}
- Địa điểm: ${n.job.locationRequirement}

**ỨNG VIÊN CẦN SO SÁNH:**
${h.map((i,c)=>`
${c+1}. ${i.name}
   - Hạng: ${i.rank} (${i.score} điểm)
   - Vị trí: ${i.title}
   - Cấp độ: ${i.level}
   - Điểm mạnh: ${i.strengths.slice(0,3).join(", ")}
   - Điểm yếu: ${i.weaknesses.slice(0,2).join(", ")}
`).join(`
`)}

**MỤC TIÊU:**
Tạo câu hỏi giúp HR so sánh trực tiếp và chọn ứng viên phù hợp nhất cho vị trí ${r.jobPosition}.

**YÊU CẦU:**
1. Câu hỏi phải giúp phân biệt rõ ràng giữa các ứng viên
2. Tập trung vào những điểm khác biệt quan trọng
3. Câu hỏi tình huống để test khả năng xử lý thực tế
4. So sánh về technical skills, soft skills, cultural fit
5. Câu hỏi về motivation và commitment
6. Đánh giá potential và growth mindset

**NHÓM CÂUHỎI:**
- Câu hỏi phân biệt khả năng kỹ thuật
- So sánh kinh nghiệm và achievements
- Đánh giá leadership và teamwork
- Test problem-solving approach
- Cultural fit và long-term commitment
- Scenario-based questions

Mỗi nhóm 4-5 câu, thiết kế để so sánh trực tiếp. Trả về JSON format.
`},te=({analysisData:n,selectedCandidates:r=[],onClose:o})=>{const[h,i]=b.useState(!1),[c,g]=b.useState([]),[m,C]=b.useState("general"),[f,k]=b.useState(""),p=b.useMemo(()=>{const t=n.candidates.filter(a=>a.status==="SUCCESS"),s=[...new Set(t.map(a=>a.industry).filter(Boolean))],l=[...new Set(t.map(a=>a.experienceLevel).filter(Boolean))],u=t.filter(a=>{var x;return((x=a.analysis)==null?void 0:x.Hạng)==="A"}).slice(0,5),w=new Map;t.forEach(a=>{var x,S;(S=(x=a.analysis)==null?void 0:x["Điểm yếu CV"])==null||S.forEach(T=>{w.set(T,(w.get(T)||0)+1)})});const j=new Map;return t.forEach(a=>{var x,S;(S=(x=a.analysis)==null?void 0:x["Chi tiết"])==null||S.forEach(T=>{const I=parseFloat(T.Điểm.split("/")[0]),H=parseFloat(T.Điểm.split("/")[1]);I/H*100<50&&j.set(T["Tiêu chí"],(j.get(T["Tiêu chí"])||0)+1)})}),{jobPosition:n.job.position,totalCandidates:t.length,industries:s.slice(0,3),levels:l.slice(0,3),topCandidates:u,commonWeaknesses:Array.from(w.entries()).sort((a,x)=>x[1]-a[1]).slice(0,5).map(([a])=>a),skillGaps:Array.from(j.entries()).sort((a,x)=>x[1]-a[1]).slice(0,5).map(([a])=>a)}},[n]),$=async()=>{i(!0);try{let t=null;m==="specific"&&f?t=n.candidates.find(l=>l.id===f):m==="comparative"&&r.length>0&&(t=r);const s=await z(n,p,m,t);g(s)}catch(t){console.error("Error generating questions:",t),g(N())}finally{i(!1)}},N=()=>{const{jobPosition:t,industries:s,commonWeaknesses:l}=p;return[{category:"Câu hỏi chung về vị trí",icon:"fa-solid fa-briefcase",color:"text-blue-400",questions:[`Bạn hiểu như thế nào về vai trò ${t} trong tổ chức?`,`Những thách thức lớn nhất mà một ${t} thường gặp phải là gì?`,`Bạn có kinh nghiệm gì liên quan đến ${t}?`,"Tại sao bạn quan tâm đến vị trí này?","Điều gì làm bạn khác biệt so với các ứng viên khác?"]},{category:"Câu hỏi kỹ thuật theo ngành",icon:"fa-solid fa-cogs",color:"text-green-400",questions:s.length>0?[`Trong ngành ${s[0]}, xu hướng nào đang ảnh hưởng lớn nhất?`,"Bạn đã từng giải quyết vấn đề phức tạp nào trong công việc?","Mô tả một dự án thành công mà bạn đã tham gia.","Bạn cập nhật kiến thức chuyên môn bằng cách nào?"]:["Mô tả kinh nghiệm làm việc ấn tượng nhất của bạn.","Bạn xử lý áp lực công việc như thế nào?","Kỹ năng nào bạn muốn phát triển thêm?"]},{category:"Câu hỏi về điểm yếu phổ biến",icon:"fa-solid fa-exclamation-triangle",color:"text-orange-400",questions:l.length>0?[`Nhiều ứng viên có vấn đề về "${l[0]}". Bạn tự đánh giá thế nào?`,"Bạn đã khắc phục những thiếu sót trong CV như thế nào?","Điểm yếu lớn nhất của bạn là gì và bạn cải thiện ra sao?"]:["Điểm yếu lớn nhất của bạn là gì?","Bạn học hỏi từ thất bại như thế nào?","Kỹ năng nào bạn cần cải thiện?"]}]},v=n.candidates.filter(t=>t.status==="SUCCESS").sort((t,s)=>{var l,u;return(((l=s.analysis)==null?void 0:l["Tổng điểm"])||0)-(((u=t.analysis)==null?void 0:u["Tổng điểm"])||0)});return e.jsxs("div",{className:"bg-slate-800/90 border border-slate-700 rounded-2xl shadow-2xl max-w-4xl mx-auto",children:[e.jsx("div",{className:"p-6 border-b border-slate-700 bg-gradient-to-r from-purple-900/20 to-blue-900/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("i",{className:"fa-solid fa-question-circle text-purple-400"}),"Gợi ý Câu hỏi Phỏng vấn AI"]}),e.jsx("p",{className:"text-slate-300 mt-2",children:"Tạo câu hỏi phỏng vấn thông minh dựa trên JD và dữ liệu lọc CV"})]}),o&&e.jsx("button",{onClick:o,className:"text-slate-400 hover:text-white transition-colors p-2",children:e.jsx("i",{className:"fa-solid fa-times text-xl"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-chart-bar text-cyan-400"}),"Tổng quan dữ liệu lọc CV"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-slate-400",children:"Vị trí tuyển dụng"}),e.jsx("div",{className:"text-white font-semibold",children:p.jobPosition})]}),e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-slate-400",children:"Tổng ứng viên"}),e.jsx("div",{className:"text-white font-semibold",children:p.totalCandidates})]}),e.jsxs("div",{className:"bg-slate-700/50 rounded-lg p-3",children:[e.jsx("div",{className:"text-slate-400",children:"Ứng viên hạng A"}),e.jsx("div",{className:"text-white font-semibold",children:p.topCandidates.length})]})]}),p.industries.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-slate-400 text-sm",children:"Ngành nghề chính:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:p.industries.map((t,s)=>e.jsx("span",{className:"bg-blue-900/30 text-blue-300 px-2 py-1 rounded text-xs",children:t},s))})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-3",children:"Chọn loại câu hỏi:"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("button",{onClick:()=>C("general"),className:`p-4 rounded-xl border transition-all ${m==="general"?"border-purple-500 bg-purple-900/20 text-purple-300":"border-slate-600 bg-slate-700/30 text-slate-300 hover:border-slate-500"}`,children:[e.jsx("i",{className:"fa-solid fa-users text-xl mb-2 block"}),e.jsx("div",{className:"font-semibold",children:"Câu hỏi chung"}),e.jsx("div",{className:"text-sm opacity-80",children:"Dựa trên JD và xu hướng chung"})]}),e.jsxs("button",{onClick:()=>C("specific"),className:`p-4 rounded-xl border transition-all ${m==="specific"?"border-green-500 bg-green-900/20 text-green-300":"border-slate-600 bg-slate-700/30 text-slate-300 hover:border-slate-500"}`,children:[e.jsx("i",{className:"fa-solid fa-user text-xl mb-2 block"}),e.jsx("div",{className:"font-semibold",children:"Câu hỏi cụ thể"}),e.jsx("div",{className:"text-sm opacity-80",children:"Dành cho 1 ứng viên cụ thể"})]}),e.jsxs("button",{onClick:()=>C("comparative"),className:`p-4 rounded-xl border transition-all ${m==="comparative"?"border-orange-500 bg-orange-900/20 text-orange-300":"border-slate-600 bg-slate-700/30 text-slate-300 hover:border-slate-500"}`,children:[e.jsx("i",{className:"fa-solid fa-balance-scale text-xl mb-2 block"}),e.jsx("div",{className:"font-semibold",children:"So sánh ứng viên"}),e.jsx("div",{className:"text-sm opacity-80",children:"Câu hỏi để so sánh nhiều ứng viên"})]})]})]}),m==="specific"&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-white font-semibold mb-2",children:"Chọn ứng viên:"}),e.jsxs("select",{value:f,onChange:t=>k(t.target.value),className:"w-full bg-slate-700 border border-slate-600 rounded-lg px-4 py-2 text-white",children:[e.jsx("option",{value:"",children:"-- Chọn ứng viên --"}),v.map(t=>{var s,l;return e.jsxs("option",{value:t.id,children:[t.candidateName," - Hạng ",(s=t.analysis)==null?void 0:s.Hạng," (",(l=t.analysis)==null?void 0:l["Tổng điểm"]," điểm)"]},t.id)})]})]}),m==="comparative"&&r.length>0&&e.jsxs("div",{className:"mb-6 bg-slate-800/50 rounded-xl p-4",children:[e.jsx("h4",{className:"text-white font-semibold mb-2",children:"Ứng viên được chọn để so sánh:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(t=>{var s;return e.jsxs("span",{className:"bg-orange-900/30 text-orange-300 px-3 py-1 rounded-full text-sm",children:[t.candidateName," (Hạng ",(s=t.analysis)==null?void 0:s.Hạng,")"]},t.id)})})]}),e.jsx("div",{className:"text-center mb-6",children:e.jsx("button",{onClick:$,disabled:h||m==="specific"&&!f,className:"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 disabled:from-slate-600 disabled:to-slate-600 text-white px-8 py-3 rounded-xl font-semibold transition-all transform hover:scale-105 disabled:scale-100 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-spinner fa-spin mr-2"}),"Đang tạo câu hỏi..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fa-solid fa-magic mr-2"}),"Tạo câu hỏi phỏng vấn"]})})}),c.length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-list-check text-green-400"}),"Câu hỏi phỏng vấn được đề xuất"]}),c.map((t,s)=>e.jsxs("div",{className:"bg-slate-800/60 rounded-xl border border-slate-700",children:[e.jsx("div",{className:"p-4 border-b border-slate-700",children:e.jsxs("h4",{className:`text-lg font-semibold ${t.color} flex items-center gap-2`,children:[e.jsx("i",{className:t.icon}),t.category]})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-3",children:t.questions.map((l,u)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-slate-700/30 rounded-lg hover:bg-slate-700/50 transition-colors",children:[e.jsx("div",{className:`w-6 h-6 rounded-full ${t.color.replace("text-","bg-").replace("400","500")} flex items-center justify-center text-white text-xs font-bold flex-shrink-0 mt-0.5`,children:u+1}),e.jsx("p",{className:"text-slate-200 leading-relaxed",children:l}),e.jsx("button",{onClick:()=>navigator.clipboard.writeText(l),className:"text-slate-400 hover:text-white transition-colors p-1 flex-shrink-0",title:"Copy câu hỏi",children:e.jsx("i",{className:"fa-solid fa-copy"})})]},u))})})]},s)),e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>{const t=c.map(s=>`${s.category}:
${s.questions.map((l,u)=>`${u+1}. ${l}`).join(`
`)}`).join(`

`);navigator.clipboard.writeText(t)},className:"bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-lg transition-colors",children:[e.jsx("i",{className:"fa-solid fa-copy mr-2"}),"Copy tất cả câu hỏi"]})})]})]})]})},le=()=>{const[n,r]=b.useState(null),[o,h]=b.useState(new Set),[i,c]=b.useState(""),[g,m]=b.useState("all"),[C,f]=b.useState(!1);b.useEffect(()=>{const t=localStorage.getItem("cvAnalysis.latest");if(t)try{const s=JSON.parse(t),l=s.candidates.sort((u,w)=>{var j,a;return(((j=w.analysis)==null?void 0:j["Tổng điểm"])||0)-(((a=u.analysis)==null?void 0:a["Tổng điểm"])||0)});r({...s,candidates:l})}catch(s){console.error("Failed to parse analysis data from localStorage",s),r(null)}},[]);const k=b.useCallback(t=>{h(s=>{const l=new Set(s);return l.has(t)?l.delete(t):l.add(t),l})},[]),p=b.useMemo(()=>{if(!n)return{total:0,countA:0,countB:0,countC:0,failed:0};const t=n.candidates,s=t.length,l=t.filter(a=>{var x;return((x=a.analysis)==null?void 0:x.Hạng)==="A"}).length,u=t.filter(a=>{var x;return((x=a.analysis)==null?void 0:x.Hạng)==="B"}).length,w=t.filter(a=>{var x;return((x=a.analysis)==null?void 0:x.Hạng)==="C"}).length,j=t.filter(a=>a.status==="FAILED").length;return{total:s,countA:l,countB:u,countC:w,failed:j}},[n]),$=b.useMemo(()=>{if(!n)return[];let t=n.candidates;if(g!=="all"&&(g==="FAILED"?t=t.filter(s=>s.status==="FAILED"):t=t.filter(s=>{var l;return((l=s.analysis)==null?void 0:l.Hạng)===g&&s.status==="SUCCESS"})),i){const s=i.toLowerCase();t=t.filter(l=>{var u,w;return((u=l.candidateName)==null?void 0:u.toLowerCase().includes(s))||((w=l.jobTitle)==null?void 0:w.toLowerCase().includes(s))})}return t},[n,i,g]),N=b.useCallback(()=>{if(!n)return;const t=n.candidates.filter(a=>o.has(a.id));if(t.length===0)return;const s=["Rank","Name","Grade","Total Score","JD Fit (%)","Phone","Email","Strengths","Weaknesses"],l=t.map((a,x)=>{var S,T,I,H,E,P,V,M,B,d;return[x+1,a.candidateName,((S=a.analysis)==null?void 0:S.Hạng)||"N/A",((T=a.analysis)==null?void 0:T["Tổng điểm"])||"N/A",((P=(E=(H=(I=a.analysis)==null?void 0:I["Chi tiết"])==null?void 0:H.find(y=>y["Tiêu chí"].startsWith("Phù hợp JD")))==null?void 0:E.Điểm)==null?void 0:P.split("/")[0])||"N/A",a.phone||"N/A",a.email||"N/A",`"${((M=(V=a.analysis)==null?void 0:V["Điểm mạnh CV"])==null?void 0:M.join(", "))||"N/A"}"`,`"${((d=(B=a.analysis)==null?void 0:B["Điểm yếu CV"])==null?void 0:d.join(", "))||"N/A"}"`].join(",")}),u="data:text/csv;charset=utf-8,"+[s.join(","),...l].join(`
`),w=encodeURI(u),j=document.createElement("a");j.setAttribute("href",w),j.setAttribute("download",`cv_export_${n.job.position.replace(/\s/g,"_")}.csv`),document.body.appendChild(j),j.click(),document.body.removeChild(j)},[n,o]);if(!n)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] text-center",children:[e.jsx("i",{className:"fa-solid fa-folder-open text-6xl text-slate-600 mb-6 animate-pulse"}),e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Chưa có dữ liệu phân tích"}),e.jsx("p",{className:"text-slate-400 mt-2 max-w-md",children:"Vui lòng quay lại trang chính và chạy một lượt phân tích CV để xem dashboard."})]});const v=({title:t,value:s,colorClass:l})=>e.jsxs("div",{className:"bg-slate-800/50 p-5 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:t}),e.jsx("p",{className:`text-3xl font-bold ${l} mt-1`,children:s})]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("header",{className:"border-b border-slate-700 pb-4",children:[e.jsx("p",{className:"text-sm text-sky-400 font-semibold",children:"Dashboard Tuyển dụng"}),e.jsx("h1",{className:"text-3xl font-bold text-white mt-1",children:n.job.position}),e.jsxs("p",{className:"text-slate-400 mt-2 text-sm",children:["Phân tích lúc: ",e.jsx("span",{className:"font-semibold text-slate-300",children:new Date(n.timestamp).toLocaleString("vi-VN")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(v,{title:"Tổng CV Phân Tích",value:p.total,colorClass:"text-white"}),e.jsx(v,{title:"Hạng A",value:p.countA,colorClass:"text-emerald-400"}),e.jsx(v,{title:"Hạng B",value:p.countB,colorClass:"text-blue-400"}),e.jsx(v,{title:"Hạng C/Lỗi",value:p.countC+p.failed,colorClass:"text-red-400"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/50 p-3 rounded-xl border border-slate-700 flex flex-col sm:flex-row gap-3 items-center flex-wrap",children:[e.jsxs("div",{className:"relative flex-grow sm:flex-grow-0",children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass text-slate-500 absolute left-4 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:"Tìm theo tên, chức danh...",value:i,onChange:t=>c(t.target.value),className:"w-full sm:w-60 pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-sky-500"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-slate-700/50 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>m("all"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${g==="all"?"bg-sky-600 text-white":"text-slate-300 hover:bg-slate-600"}`,children:"Tất cả"}),e.jsx("button",{onClick:()=>m("A"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${g==="A"?"bg-emerald-600 text-white":"text-slate-300 hover:bg-slate-600"}`,children:"Hạng A"}),e.jsx("button",{onClick:()=>m("B"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${g==="B"?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-600"}`,children:"Hạng B"}),e.jsx("button",{onClick:()=>m("C"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${g==="C"?"bg-amber-600 text-white":"text-slate-300 hover:bg-slate-600"}`,children:"Hạng C"}),e.jsx("button",{onClick:()=>m("FAILED"),className:`px-3 py-1 text-sm font-semibold rounded-md transition-colors ${g==="FAILED"?"bg-red-600 text-white":"text-slate-300 hover:bg-slate-600"}`,children:"Lỗi"})]}),e.jsx("div",{className:"flex-grow text-right",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>f(!0),className:"h-9 px-4 flex items-center justify-center text-sm font-medium text-slate-200 bg-purple-600/50 border border-purple-500/50 rounded-lg hover:bg-purple-600/80 transition-colors duration-200",children:[e.jsx("i",{className:"fa-solid fa-question-circle mr-2"}),"Gợi ý câu hỏi PV"]}),e.jsxs("button",{onClick:N,disabled:o.size===0,className:"h-9 px-4 flex items-center justify-center text-sm font-medium text-slate-200 bg-emerald-600/50 border border-emerald-500/50 rounded-lg hover:bg-emerald-600/80 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-slate-600/50 disabled:border-slate-500",children:[e.jsx("i",{className:"fa-solid fa-file-csv mr-2"}),"Xuất ",o.size>0?`${o.size} `:"","CV (CSV)"]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[$.map((t,s)=>e.jsxs("div",{className:"relative group",children:[e.jsx(Q,{candidate:t,rank:s+1}),e.jsx("label",{className:"absolute top-5 right-5 w-6 h-6 flex items-center justify-center cursor-pointer",children:e.jsx("input",{type:"checkbox",checked:o.has(t.id),onChange:()=>k(t.id),className:"w-5 h-5 bg-slate-700 border-slate-500 rounded text-sky-500 focus:ring-sky-600 transition-opacity duration-200 opacity-50 group-hover:opacity-100 checked:opacity-100"})})]},t.id)),$.length===0&&e.jsxs("div",{className:"text-center py-16 text-slate-500",children:[e.jsx("i",{className:"fa-solid fa-ghost text-4xl mb-4"}),e.jsx("p",{children:"Không có ứng viên nào khớp bộ lọc."})]})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:e.jsx(te,{analysisData:n,selectedCandidates:Array.from(o).map(t=>n.candidates.find(s=>s.id===t)).filter(Boolean),onClose:()=>f(!1)})})})]})};export{le as default};
