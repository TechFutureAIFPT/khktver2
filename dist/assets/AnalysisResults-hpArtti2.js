import{c as ee,g as fe,r as I,j as e,R as se}from"./index-CsrQR31d.js";import{g as he}from"./ScreenerPage-DH2JNpun.js";import"./index-Ce2_9GLb.js";var oe,xe;function be(){if(xe)return oe;xe=1;var s="Expected a function",h=NaN,c="[object Symbol]",m=/^\s+|\s+$/g,j=/^[-+]0x[0-9a-f]+$/i,x=/^0b[01]+$/i,l=/^0o[0-7]+$/i,g=parseInt,f=typeof ee=="object"&&ee&&ee.Object===Object&&ee,N=typeof self=="object"&&self&&self.Object===Object&&self,A=f||N||Function("return this")(),F=Object.prototype,S=F.toString,$=Math.max,k=Math.min,a=function(){return A.Date.now()};function r(t,T,D){var w,R,M,B,P,q,z=0,Z=!1,J=!1,G=!0;if(typeof t!="function")throw new TypeError(s);T=u(T)||0,i(D)&&(Z=!!D.leading,J="maxWait"in D,M=J?$(u(D.maxWait)||0,T):M,G="trailing"in D?!!D.trailing:G);function W(o){var y=w,v=R;return w=R=void 0,z=o,B=t.apply(v,y),B}function _(o){return z=o,P=setTimeout(O,T),Z?W(o):B}function U(o){var y=o-q,v=o-z,L=T-y;return J?k(L,M-v):L}function Y(o){var y=o-q,v=o-z;return q===void 0||y>=T||y<0||J&&v>=M}function O(){var o=a();if(Y(o))return n(o);P=setTimeout(O,U(o))}function n(o){return P=void 0,G&&w?W(o):(w=R=void 0,B)}function C(){P!==void 0&&clearTimeout(P),z=0,w=q=R=P=void 0}function p(){return P===void 0?B:n(a())}function b(){var o=a(),y=Y(o);if(w=arguments,R=this,q=o,y){if(P===void 0)return _(q);if(J)return P=setTimeout(O,T),W(q)}return P===void 0&&(P=setTimeout(O,T)),B}return b.cancel=C,b.flush=p,b}function i(t){var T=typeof t;return!!t&&(T=="object"||T=="function")}function d(t){return!!t&&typeof t=="object"}function E(t){return typeof t=="symbol"||d(t)&&S.call(t)==c}function u(t){if(typeof t=="number")return t;if(E(t))return h;if(i(t)){var T=typeof t.valueOf=="function"?t.valueOf():t;t=i(T)?T+"":T}if(typeof t!="string")return t===0?t:+t;t=t.replace(m,"");var D=x.test(t);return D||l.test(t)?g(t.slice(2),D?2:8):j.test(t)?h:+t}return oe=r,oe}var je=be();const Ne=fe(je),te=["frontend","backend","fullstack","mobile","android","ios","devops","data","qa","tester","product","designer","ui","ux"],ne=["java","spring","react","node","python","django","flask","golang","go","dotnet",".net","c#","c++","kotlin","swift","angular","vue","flutter","docker","kubernetes","k8s","sql","mysql","postgres","mongodb","redis","kafka","elasticsearch","aws","azure","gcp","cloud","terraform"],le=["fintech","ecommerce","banking","payment","logistics","edtech","education","healthcare","retail","saas"],ae=["agile","scrum","kanban","ci/cd","cicd","tdd","devops"],ie=["lead","leader","leadership","mentor","ownership","independent","autonomous","self-driven"];function re(s){return s.toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}+","gu"),"").replace(/[^a-z0-9+./#\-\s]/g," ").replace(/\s+/g," ").trim()}function Q(s){return[...new Set(s)]}function ue(s){const h=[];let c;const m=/(\d+)\s*[-–]\s*(\d+)\s*(?:nam|year|yrs|y)/gi,j=/(\d+)\s*(?:\+|plus)?\s*(?:nam|year|yrs|y)/gi;let x;for(;x=m.exec(s);)h.push(`years_${x[1]}-${x[2]}`),c=Math.max(c??0,parseInt(x[2],10));for(;x=j.exec(s);){const l=parseInt(x[1],10);h.push(`years>=${l}`),c=Math.max(c??0,l)}return{yearsTokens:Q(h),maxYears:c}}function ye(s){if(!s)return{keywords:[]};const m=re(s).split(/\n|\r/).map(N=>N.trim()).filter(Boolean).filter(N=>/(yeu cau|kinh nghiem|requirement|experience|qualification)/.test(N));if(m.length===0)return{keywords:[]};const j=m.join(" "),{yearsTokens:x,maxYears:l}=ue(j),g=[...x],f=(N,A)=>{A.forEach(F=>{j.includes(F)&&g.push(F)})};return f(g,te),f(g,ne),f(g,le),f(g,ae),f(g,ie),{keywords:Q(g),requiredYears:l}}function ve(s){if(!s)return{keywords:[]};const h=re(s),{yearsTokens:c,maxYears:m}=ue(h),j=[...c],x=(l,g)=>g.forEach(f=>{l.includes(f)&&j.push(f)});return x(h,te),x(h,ne),x(h,le),x(h,ae),x(h,ie),{keywords:Q(j),totalYears:m}}function we(s,h,c,m){if(s.length===0)return{jdKeywords:[],cvKeywords:h,matched:[],missing:[],uncertain:[],matchPercent:"N/A",fitLabel:"N/A"};const j=s.filter(i=>h.includes(i)),x=s.filter(i=>!h.includes(i)&&!i.startsWith("years")),l=[],g={years:35,role:25,tech:25,domain_method:10,leadership:5};let f=0,N=0;if(s.some(i=>i.startsWith("years"))&&c!==void 0&&(N+=g.years,m!==void 0?m>=c?f+=g.years:m>=.8*c&&(f+=g.years*.5):l.push(s.find(i=>i.startsWith("years")))),s.some(i=>te.includes(i))&&(N+=g.role,h.some(i=>te.includes(i))?f+=g.role:l.push("role")),s.some(i=>ne.includes(i))){N+=g.tech;const i=s.filter(E=>ne.includes(E));i.some(E=>h.includes(E))?f+=g.tech:x.push(i[0])}s.some(i=>le.includes(i)||ae.includes(i))&&(N+=g.domain_method,h.some(d=>le.includes(d)||ae.includes(d))?f+=g.domain_method:l.push("domain/method")),s.some(i=>ie.includes(i))&&(N+=g.leadership,h.some(d=>ie.includes(d))?f+=g.leadership:l.push("leadership"));const a=N===0?"N/A":parseFloat((f/N*100).toFixed(1));let r="N/A";return a!=="N/A"&&(r=a>=80?"Strong Fit":a>=65?"Good":a>=50?"Moderate":"Low"),{jdKeywords:s,cvKeywords:h,matched:j,missing:Q(x),uncertain:Q(l),matchPercent:a,fitLabel:r,totalYearsCV:m,requiredYearsJD:c}}function Ce(s,h){const{keywords:c,requiredYears:m}=ye(s),{keywords:j,totalYears:x}=ve(h);return we(c,j,m,x)}const Te=["java","spring","react","node","python","kotlin","swift","docker","kubernetes","k8s","terraform","aws","azure","gcp","sql","mongodb","redis","kafka","elk","elasticsearch","microservice","microservices"],ke=["kpi","%","percent","tăng","giam","increase","reduce","growth","roi","revenue","throughput","latency","users","mau","dau"],Se=["dai hoc","university","college","bachelor","master","phd","cử nhân","thạc sĩ","tiến sĩ"],Ee=["english","toeic","ielts","japanese","n2","chinese","korean","german"],Ie=["report","documentation","process","compliance","standard","iso"],Ae=["months","years"],De=["teamwork","collaborative","ownership","growth mindset","adapt","communication"],Le=[{key:"jobfit",display:"Phù hợp JD (Job Fit)",hints:[]},{key:"experience",display:"Kinh nghiệm",hints:[]},{key:"skills",display:"Kỹ năng",hints:Te},{key:"achievements",display:"Thành tựu/KPI",hints:ke},{key:"education",display:"Học vấn",hints:Se},{key:"language",display:"Ngôn ngữ",hints:Ee},{key:"professional",display:"Chuyên nghiệp",hints:Ie},{key:"stability",display:"Gắn bó & Lịch sử CV",hints:Ae},{key:"culture",display:"Phù hợp văn hoá",hints:De}];function Fe(s){if(!s)return[];const h=re(s),c=[];return Le.forEach(m=>{if(m.key!=="experience")if(m.hints.length===0){const j=Array.from(new Set(h.match(/\b[a-z]{4,}\b/g)||[])).filter(x=>x.length<=16&&/dev|engineer|developer|product|design|data|qa|test|front|back|full|lead|manager/.test(x)).slice(0,12);c.push({key:m.key,display:m.display,keywords:j})}else{const j=m.hints.filter(x=>h.includes(x)).slice(0,20);j.length&&c.push({key:m.key,display:m.display,keywords:j})}}),c}function $e(s,h,c){if(h.length===0)return null;const m=re(c||"").replace(/\n+/g," "),j=h.filter(l=>m.includes(l)),x=h.filter(l=>!m.includes(l));return{display:s,jdKeywords:h,matched:j,missing:x}}const me=["Phù hợp JD (Job Fit)","Kinh nghiệm","Kỹ năng","Thành tựu/KPI","Học vấn","Ngôn ngữ","Chuyên nghiệp","Gắn bó & Lịch sử CV","Phù hợp văn hoá"],Re={"Phù hợp JD (Job Fit)":{icon:"fa-solid fa-bullseye",color:"text-sky-400"},"Kinh nghiệm":{icon:"fa-solid fa-briefcase",color:"text-green-400"},"Kỹ năng":{icon:"fa-solid fa-gears",color:"text-purple-400"},"Thành tựu/KPI":{icon:"fa-solid fa-trophy",color:"text-yellow-400"},"Học vấn":{icon:"fa-solid fa-graduation-cap",color:"text-indigo-400"},"Ngôn ngữ":{icon:"fa-solid fa-language",color:"text-orange-400"},"Chuyên nghiệp":{icon:"fa-solid fa-file-invoice",color:"text-cyan-400"},"Gắn bó & Lịch sử CV":{icon:"fa-solid fa-hourglass-half",color:"text-lime-400"},"Phù hợp văn hoá":{icon:"fa-solid fa-users-gear",color:"text-pink-400"}},Pe=({item:s,isExpanded:h,onToggle:c,jdText:m})=>{const[j,x]=se.useState(!1),l=I.useMemo(()=>{var P;const t=s.Điểm.match(/([\d.]+)\/([\d.]+)/),T=parseFloat((t==null?void 0:t[1])||"0"),D=parseFloat((t==null?void 0:t[2])||"0");console.log("Formula from AI:",s["Công thức"]),console.log("Score format:",s.Điểm);let w=s["Công thức"].match(/subscore ([\d.]+)\/([\d.]+)% = ([\d.]+) points/),R=parseFloat((w==null?void 0:w[1])||"0"),M=parseFloat((w==null?void 0:w[2])||"0"),B=(w==null?void 0:w[3])||"0";if(w||(w=s["Công thức"].match(/subscore ([\d.]+) × trọng số ([\d]+)% = (.*)$/),R=parseFloat((w==null?void 0:w[1])||"0"),M=parseFloat((w==null?void 0:w[2])||"0"),B=((P=w==null?void 0:w[3])==null?void 0:P.trim())||"0"),!w){const q=s["Công thức"].match(/[\d.]+/g);q&&q.length>=2&&(R=parseFloat(q[0]),M=D,B=R.toString())}return console.log("Parsed data:",{score:T,maxScore:D,subscore:R,weight:M,formulaResult:B}),{score:T,maxScore:D,subscore:R,weight:M,formulaResult:B}},[s]),g=()=>{navigator.clipboard.writeText(s["Dẫn chứng"]),x(!0),setTimeout(()=>x(!1),2e3)},f=Re[s["Tiêu chí"]]||{icon:"fa-solid fa-question-circle",color:"text-slate-400"},N=l.score/l.maxScore*100,A=N>=85?"bg-emerald-500/20 text-emerald-300 border-emerald-500/30":N>=65?"bg-yellow-500/20 text-yellow-300 border-yellow-500/30":"bg-red-500/20 text-red-300 border-red-500/30",F=N>=90?"Expert":N>=75?"Advanced":N>=55?"Intermediate":"Beginner",S=[];N<55&&(/Kỹ năng/i.test(s["Tiêu chí"])&&S.push("Bổ sung chứng chỉ hoặc dự án thực tế thể hiện mức độ làm chủ công nghệ cốt lõi."),/Kinh nghiệm/i.test(s["Tiêu chí"])&&S.push("Làm rõ số năm, phạm vi trách nhiệm và kết quả định lượng trong từng vai trò."),/Thành tựu|KPI/i.test(s["Tiêu chí"])&&S.push("Thêm KPI cụ thể (ví dụ: % cải thiện, số người dùng, tốc độ, doanh thu)."),/Học vấn/i.test(s["Tiêu chí"])&&S.push("Bổ sung chuyên ngành, đề tài hoặc môn học liên quan JD."),/Ngôn ngữ/i.test(s["Tiêu chí"])&&S.push("Ghi rõ cấp độ (IELTS/TOEIC/CEFR) hoặc kinh nghiệm sử dụng trong môi trường quốc tế."),/Chuyên nghiệp/i.test(s["Tiêu chí"])&&S.push("Chuẩn hóa format bullet, thống nhất thì hiện tại/quá khứ và kiểm tra lỗi chính tả."),/Gắn bó/i.test(s["Tiêu chí"])&&S.push("Làm rõ lý do chuyển việc hoặc nhấn mạnh các giai đoạn ổn định dài hạn."),/văn hoá/i.test(s["Tiêu chí"])&&S.push("Thêm minh chứng về teamwork, ownership hoặc growth mindset."));const $=N,k=t=>{if(!t||t==="Không tìm thấy thông tin trong CV")return t;const T=[/\b(aws|azure|gcp|docker|kubernetes|react|node|python|java|typescript|sql|mongodb|redis|kafka)\b/gi,/\b(\d+\s*(?:%|users|người|MAU|DAU|triệu|tỷ|kpi|doanh thu|revenue))\b/gi,/\b(leader|leadership|teamwork|ownership|growth|agile|scrum)\b/gi];let D=t;return T.forEach((w,R)=>{D=D.replace(w,M=>`<span class="evidence-hl hl-${R}">${M}</span>`)}),D},a=/Kinh nghiệm/i.test(s["Tiêu chí"]),r=I.useMemo(()=>Fe(m),[m]),i=I.useMemo(()=>r.find(t=>t.display===s["Tiêu chí"]),[r,s["Tiêu chí"]]),d=I.useMemo(()=>a||!i?null:$e(s["Tiêu chí"],i.keywords,s["Dẫn chứng"]),[i,s["Dẫn chứng"],a,s["Tiêu chí"]]);let E=null,u=null;return a&&(u=Ce(m,s["Dẫn chứng"]||""),E=e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg space-y-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300 mb-1",children:"Phân tích nhanh"}),u.matchPercent==="N/A"?e.jsx("p",{className:"text-xs text-slate-500 italic",children:"JD chưa có mục yêu cầu kinh nghiệm rõ ràng"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"Mức độ phù hợp JD"}),e.jsxs("span",{className:"font-semibold text-cyan-400",children:[u.matchPercent,"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-700/60 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${u.matchPercent>=80?"bg-emerald-500":u.matchPercent>=65?"bg-yellow-500":u.matchPercent>=50?"bg-orange-500":"bg-red-500"}`,style:{width:`${u.matchPercent}%`}})}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Nhận định: ",e.jsx("span",{className:"font-medium text-slate-300",children:u.fitLabel})]})]}),e.jsxs("div",{className:"pt-2 border-t border-slate-700/50 space-y-2",children:[e.jsx("div",{className:"text-[11px] text-slate-400 font-medium",children:"Keyword JD"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:u.jdKeywords.slice(0,8).map(t=>e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-700/60 text-[10px] text-slate-200 border border-slate-600",children:t},t))})]}),e.jsxs("div",{className:"pt-1 space-y-2",children:[e.jsx("div",{className:"text-[11px] text-slate-400 font-medium",children:"Khớp"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.matched.slice(0,5).map(t=>e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-emerald-600/30 text-emerald-300 text-[10px] border border-emerald-500/40",children:t},t)),u.matched.length===0&&e.jsx("span",{className:"text-[11px] text-slate-500",children:"(Không)"})]}),e.jsx("div",{className:"text-[11px] text-slate-400 font-medium",children:"Thiếu"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.missing.slice(0,5).map(t=>e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-yellow-600/30 text-yellow-300 text-[10px] border border-yellow-500/40",children:t},t)),u.missing.length===0&&e.jsx("span",{className:"text-[11px] text-slate-500",children:"(Không)"})]}),e.jsx("div",{className:"text-[11px] text-slate-400 font-medium",children:"Chưa rõ"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[u.uncertain.slice(0,5).map(t=>e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-slate-600/40 text-slate-300 text-[10px] border border-slate-500/40",children:t},t)),u.uncertain.length===0&&e.jsx("span",{className:"text-[11px] text-slate-500",children:"(Không)"})]})]}),typeof u.matchPercent=="number"&&u.matchPercent<70&&e.jsxs("div",{className:"pt-2 border-t border-slate-700/50",children:[e.jsxs("p",{className:"text-[11px] text-slate-300 font-medium flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-lightbulb text-yellow-400"}),"Gợi ý cải thiện:"]}),e.jsx("p",{className:"text-[11px] text-slate-400 leading-relaxed",children:"Làm rõ thêm thời lượng, vai trò cụ thể và công nghệ chính trong các dự án gần nhất để tăng mức phù hợp."})]})]})]})),e.jsxs("div",{className:"bg-slate-800/50 rounded-2xl border border-slate-700/80 shadow-sm transition-all duration-200 hover:shadow-lg hover:border-blue-600/60",children:[e.jsxs("button",{className:"w-full flex items-center justify-between p-4 h-[64px] text-left",onClick:c,"aria-expanded":h,children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("i",{className:`${f.icon} ${f.color} w-5 text-center text-lg`}),e.jsx("span",{className:"font-semibold text-slate-200 truncate",children:s["Tiêu chí"]}),e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded text-[10px] tracking-wide font-semibold bg-slate-700/70 text-slate-300 border border-slate-600",children:F})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`text-base font-bold px-3 py-1.5 rounded-lg text-white ${A.replace(/text-\w+-\d+/,"").replace("border-transparent","")}`,children:[l.score,e.jsxs("span",{className:"text-xs text-slate-400",children:["/",l.maxScore]})]}),e.jsx("i",{className:`fa-solid fa-chevron-down text-slate-400 transition-transform duration-300 ${h?"rotate-180":""}`})]})]}),h&&e.jsx("div",{className:"px-4 pb-4 pt-2 border-t border-slate-700/50",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300",children:"Dẫn chứng (trích từ CV)"}),e.jsxs("button",{onClick:g,className:"text-xs text-slate-400 hover:text-white transition-colors flex items-center gap-1.5",children:[e.jsx("i",{className:`fa-solid ${j?"fa-check text-emerald-400":"fa-copy"}`}),j?"Đã chép":"Chép"]})]}),e.jsx("blockquote",{className:"text-sm text-slate-400 italic border-l-2 border-blue-500 pl-3 leading-relaxed evidence-block",dangerouslySetInnerHTML:{__html:s["Dẫn chứng"]==="Không tìm thấy thông tin trong CV"?'<span class="not-italic bg-yellow-500/10 text-yellow-400 px-2 py-1 rounded-md text-xs font-semibold">Chưa tìm thấy trong CV</span>':k(s["Dẫn chứng"])}})]}),a&&E,!a&&d&&e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg space-y-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300 mb-1",children:"Phân tích nhanh"}),e.jsxs("div",{className:"text-[11px] text-slate-400",children:["Từ khóa JD (",d.jdKeywords.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-1 mb-2",children:d.jdKeywords.slice(0,12).map(t=>e.jsx("span",{className:"pill pill--uncertain",children:t},t))}),e.jsx("div",{className:"text-[11px] text-slate-400 font-medium",children:"Khớp"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.matched.length>0?d.matched.slice(0,10).map(t=>e.jsx("span",{className:"pill pill--match",children:t},t)):e.jsx("span",{className:"text-[11px] text-slate-500",children:"(Không)"})}),e.jsx("div",{className:"text-[11px] text-slate-400 font-medium mt-2",children:"Thiếu"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:d.missing.length>0?d.missing.slice(0,10).map(t=>e.jsx("span",{className:"pill pill--missing",children:t},t)):e.jsx("span",{className:"text-[11px] text-slate-500",children:"(Không)"})})]}),e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300 mb-3",children:"Giải thích & Công thức"}),!a&&d&&e.jsxs("div",{className:"mb-2 text-[11px] text-slate-400 bg-slate-800/60 border border-slate-700/60 rounded p-2 leading-relaxed",children:[e.jsx("span",{className:"text-slate-300 font-medium",children:"So khớp JD:"})," ",d.matched.length,"/",d.jdKeywords.length," từ khóa xuất hiện.",d.missing.length>0&&e.jsxs(e.Fragment,{children:[" ","Thiếu ",e.jsx("span",{className:"text-yellow-300 font-medium",children:d.missing.length})," từ: ",d.missing.slice(0,3).join(", "),d.missing.length>3?"…":""]})]}),a&&u&&e.jsxs("div",{className:"mb-2 text-[11px] text-slate-400 bg-slate-800/60 border border-slate-700/60 rounded p-2 leading-relaxed",children:[e.jsx("span",{className:"text-slate-300 font-medium",children:"Tổng quan kinh nghiệm:"})," ",u.matchPercent==="N/A"?"Không xác định":`${u.matchPercent}% (${u.fitLabel})`,".",u.missing.length>0&&e.jsxs(e.Fragment,{children:[" Thiếu: ",e.jsxs("span",{className:"text-yellow-300 font-medium",children:[u.missing.slice(0,3).join(", "),u.missing.length>3?"…":""]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:s["Giải thích"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"Công thức tính điểm:"}),e.jsx("div",{className:"bg-slate-800/50 p-2 rounded border border-slate-700/50",children:e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsx("span",{className:"text-slate-400",children:"Đánh giá thực tế:"}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[l.score,"/",l.maxScore]})]})}),e.jsxs("div",{className:"bg-slate-800/50 p-2 rounded border border-slate-700/50",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Công thức subscore:"}),e.jsx("div",{className:"font-mono text-xs",children:l.weight>0&&l.maxScore===l.weight?e.jsxs("span",{children:[e.jsx("span",{className:"text-cyan-400",children:l.score})," / ",e.jsxs("span",{className:"text-purple-400",children:[l.weight,"%"]})," = ",e.jsxs("span",{className:"text-yellow-400 font-bold",children:[l.formulaResult," điểm"]})]}):l.weight>0?e.jsxs("span",{children:[e.jsx("span",{className:"text-cyan-400",children:l.subscore})," × ",e.jsxs("span",{className:"text-purple-400",children:["trọng số ",l.weight,"%"]})," = ",e.jsx("span",{className:"text-yellow-400 font-bold",children:l.formulaResult})]}):e.jsx("span",{className:"text-slate-400",children:s["Công thức"]||"Không có công thức"})})]}),e.jsxs("div",{className:"bg-slate-800/50 p-2 rounded border border-slate-700/50",children:[e.jsx("div",{className:"text-xs text-slate-400 mb-1",children:"Đóng góp vào điểm tổng:"}),e.jsx("div",{className:"text-xs text-slate-300",children:l.formulaResult&&l.formulaResult!=="0"?e.jsxs("span",{children:["Tiêu chí này đóng góp ",e.jsx("span",{className:"font-bold text-yellow-400",children:l.formulaResult})," điểm",l.weight>0&&l.maxScore===l.weight?` (điểm đánh giá trực tiếp trên thang ${l.weight}%)`:l.weight>0?` (từ đánh giá ${l.subscore}/100 × ${l.weight}%)`:""]}):e.jsx("span",{className:"text-slate-500",children:"Đang tính toán..."})})]})]})]}),!a&&!d&&e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg space-y-3",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300 mb-1",children:"Phân tích nhanh"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-slate-400",children:[e.jsx("span",{children:"Mức độ phù hợp JD"}),e.jsxs("span",{className:"font-semibold text-cyan-400",children:[$.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-2 w-full bg-slate-700/60 rounded overflow-hidden",children:e.jsx("div",{className:`h-full ${$>=85?"bg-emerald-500":$>=65?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(100,Math.max(0,$))}%`}})}),e.jsxs("div",{className:"text-xs text-slate-400",children:["Đánh giá tổng quan: ",e.jsx("span",{className:"font-medium text-slate-300",children:F})]})]}),S.length>0&&e.jsxs("div",{className:"pt-2 border-t border-slate-700/50",children:[e.jsxs("p",{className:"text-xs font-semibold text-slate-300 mb-1 flex items-center gap-1",children:[e.jsx("i",{className:"fa-solid fa-lightbulb text-yellow-400"}),"Gợi ý cải thiện"]}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-[11px] text-slate-400",children:S.map((t,T)=>e.jsx("li",{children:t},T))})]})]})]})})]})},ge=({candidate:s,expandedCriteria:h,onToggleCriterion:c,jdText:m})=>{var A,F,S,$;const j=I.useMemo(()=>{var k;return(k=s.analysis)!=null&&k["Chi tiết"]?[...s.analysis["Chi tiết"]].sort((a,r)=>me.indexOf(a["Tiêu chí"])-me.indexOf(r["Tiêu chí"])):[]},[s.analysis]),x=((A=s.analysis)==null?void 0:A["Tổng điểm"])||0,l=80,g=Math.min(100,Math.round(x/l*100)),f=x>=60?"Ứng viên có nền tảng tốt, nên xem xét mời phỏng vấn.":x>=40?"Ứng viên có tiềm năng, cân nhắc nếu thiếu nguồn.":"Nên ưu tiên ứng viên khác có mức phù hợp cao hơn.",N="±0.0";return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700/70 rounded-xl p-5 flex flex-col md:flex-row gap-6",children:[e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("h4",{className:"text-lg font-semibold text-slate-100 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-chart-pie text-cyan-400"}),"Tổng hợp đánh giá"]}),e.jsxs("p",{className:"text-sm text-slate-400 leading-relaxed",children:["Ứng viên đạt ",e.jsxs("span",{className:"font-semibold text-slate-200",children:[x,"/",l]})," điểm – Mức phù hợp tổng thể: ",e.jsxs("span",{className:"font-semibold text-cyan-400",children:[g,"%"]}),". Độ ổn định điểm: ",e.jsx("span",{className:"text-slate-300 font-medium",children:N})]}),e.jsx("div",{className:"h-2 w-full bg-slate-700/50 rounded overflow-hidden",children:e.jsx("div",{className:`${g>=75?"bg-emerald-500":g>=55?"bg-yellow-500":"bg-red-500"} h-full`,style:{width:`${g}%`}})}),e.jsxs("p",{className:"text-sm text-slate-300 font-medium",children:["Nhận định: ",e.jsx("span",{className:"text-slate-200 font-normal",children:f})]})]}),e.jsxs("div",{className:"w-full md:w-60 bg-slate-900/60 rounded-lg p-4 border border-slate-700/70 flex flex-col gap-3 text-xs",children:[e.jsxs("div",{className:"flex items-center justify-between text-slate-400",children:[e.jsx("span",{children:"Điểm"}),e.jsx("span",{className:"font-mono text-slate-200",children:x})]}),e.jsxs("div",{className:"flex items-center justify-between text-slate-400",children:[e.jsx("span",{children:"Phù hợp JD"}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[g,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between text-slate-400",children:[e.jsx("span",{children:"Ổn định"}),e.jsx("span",{className:"font-mono text-slate-300",children:N})]}),e.jsx("div",{className:"pt-1 border-t border-slate-700/50 text-slate-500 leading-relaxed",children:"Hiển thị trên thang chuẩn hóa 80 điểm (8 nhóm). Dùng cho đánh giá định hướng."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[((F=s.analysis)==null?void 0:F["Điểm mạnh CV"])&&e.jsxs("div",{className:"p-4 bg-green-900/30 border border-green-500/30 rounded-xl",children:[e.jsxs("p",{className:"font-semibold text-green-300 mb-2 flex items-center gap-2 text-base",children:[e.jsx("i",{className:"fa-solid fa-wand-magic-sparkles"}),"Điểm mạnh CV"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-green-400/90 space-y-1.5 pl-2",children:s.analysis["Điểm mạnh CV"].map((k,a)=>e.jsx("li",{children:k},a))})]}),((S=s.analysis)==null?void 0:S["Điểm yếu CV"])&&e.jsxs("div",{className:"p-4 bg-red-900/30 border border-red-500/30 rounded-xl",children:[e.jsxs("p",{className:"font-semibold text-red-300 mb-2 flex items-center gap-2 text-base",children:[e.jsx("i",{className:"fa-solid fa-flag"}),"Điểm yếu CV"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-400/90 space-y-1.5 pl-2",children:s.analysis["Điểm yếu CV"].map((k,a)=>e.jsx("li",{children:k},a))})]})]}),(($=s.analysis)==null?void 0:$.educationValidation)&&e.jsxs("div",{className:"bg-slate-800/50 border border-slate-700/80 rounded-xl p-4",children:[e.jsxs("h4",{className:"text-lg font-bold text-slate-100 mb-4 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-graduation-cap text-blue-400"}),"Xác thực thông tin học vấn"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-900/70 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"text-sm font-semibold text-slate-300",children:"Thông tin học vấn chuẩn hóa"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${s.analysis.educationValidation.validationNote==="Hợp lệ"?"bg-green-600 text-green-100":"bg-red-600 text-red-100"}`,children:s.analysis.educationValidation.validationNote})]}),e.jsx("p",{className:"text-sm text-slate-400 font-mono bg-slate-800 p-2 rounded",children:s.analysis.educationValidation.standardizedEducation||"Không có thông tin"})]}),s.analysis.educationValidation.warnings&&s.analysis.educationValidation.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-500/30 p-3 rounded-lg",children:[e.jsxs("h5",{className:"text-sm font-semibold text-yellow-300 mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-triangle-exclamation"}),"Cảnh báo xác thực"]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-yellow-400/90 space-y-1 pl-2",children:s.analysis.educationValidation.warnings.map((k,a)=>e.jsx("li",{children:k},a))})]})]})]}),e.jsx("div",{children:e.jsx("div",{className:"space-y-3",children:j.map(k=>{var a;return e.jsx(Pe,{item:k,isExpanded:!!((a=h[s.id])!=null&&a[k["Tiêu chí"]]),onToggle:()=>c(s.id,k["Tiêu chí"]),jdText:m},k["Tiêu chí"])})})})]})},He=({analysisData:s,onClose:h})=>{const[c,m]=I.useState([{id:"initial",author:"bot",content:"Chào bạn, tôi là trợ lý AI. Tôi có thể giúp gì cho bạn với danh sách ứng viên này?"}]),[j,x]=I.useState(""),[l,g]=I.useState(!1),[f,N]=I.useState(!0),A=I.useRef(null);I.useEffect(()=>{var a;(a=A.current)==null||a.scrollIntoView({behavior:"smooth"})},[c]);const F=I.useMemo(()=>{const a=(s==null?void 0:s.candidates)||[],r=s.job.position;if(!a.length)return[`Ứng viên nào phù hợp nhất với vị trí ${r}?`,`3 ứng viên nào nên ưu tiên phỏng vấn đầu cho ${r}?`,`Điểm yếu quan trọng nào cần lưu ý khi chọn ứng viên cho ${r}?`];const i={};for(const t of a){const T=(t.industry||"").trim();T&&(i[T]=(i[T]||0)+1)}let d="",E=0;for(const[t,T]of Object.entries(i))T>E&&(E=T,d=t);const u=[];return d?u.push(`Ứng viên nào nổi bật nhất trong ngành ${d} cho vị trí ${r}?`,`Top 3 ứng viên ngành ${d} nên phỏng vấn đầu và lý do?`,`Những rủi ro quan trọng cần chú ý khi chọn ứng viên trong ngành ${d} cho ${r}?`):u.push(`Ứng viên nào phù hợp nhất với vị trí ${r}?`,`3 ứng viên nào nên ưu tiên phỏng vấn đầu cho ${r}?`,`Điểm yếu quan trọng nào cần lưu ý khi chọn ứng viên cho ${r}?`),u.push(`Gợi ý 5 câu hỏi phỏng vấn chính cho vị trí ${r}?`,`Câu hỏi phỏng vấn nào để đánh giá kỹ năng cốt lõi của ${r}?`,`Tôi nên hỏi gì để phân biệt ứng viên giỏi và xuất sắc cho ${r}?`),u.slice(0,3)},[s]),S=async a=>{x(a),N(!1);const r={id:Date.now().toString(),author:"user",content:a};m(i=>[...i,r]),x(""),g(!0);try{const{responseText:i,candidateIds:d}=await he(s,a),E=s.candidates.filter(t=>d.includes(t.id)),u={id:(Date.now()+1).toString(),author:"bot",content:i,suggestedCandidates:E.length>0?E.map(t=>({id:t.id,candidateName:t.candidateName,analysis:t.analysis})):void 0};m(t=>[...t,u])}catch(i){const d=i instanceof Error?i.message:"Đã có lỗi xảy ra.",E={id:(Date.now()+1).toString(),author:"bot",content:`Rất tiếc, đã có lỗi: ${d}`};m(u=>[...u,E])}finally{g(!1)}},$=async a=>{if(a.preventDefault(),!j.trim()||l)return;const r={id:Date.now().toString(),author:"user",content:j};m(i=>[...i,r]),x(""),N(!1),g(!0);try{const{responseText:i,candidateIds:d}=await he(s,j),E=s.candidates.filter(t=>d.includes(t.id)),u={id:(Date.now()+1).toString(),author:"bot",content:i,suggestedCandidates:E.length>0?E.map(t=>({id:t.id,candidateName:t.candidateName,analysis:t.analysis})):void 0};m(t=>[...t,u])}catch(i){const d=i instanceof Error?i.message:"Đã có lỗi xảy ra.",E={id:(Date.now()+1).toString(),author:"bot",content:`Rất tiếc, đã có lỗi: ${d}`};m(u=>[...u,E])}finally{g(!1)}},k=({message:a})=>{const r=a.author==="bot";return e.jsxs("div",{className:`flex gap-3 ${r?"justify-start":"justify-end"}`,children:[r&&e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-slate-600 bg-slate-700 flex items-center justify-center flex-shrink-0",children:e.jsx("img",{src:"/images/logos/logo.jpg",alt:"Support HR Bot",className:"object-cover w-full h-full",onError:i=>{const d=i.currentTarget;d.style.display="none",d.parentElement.innerHTML='<i class="fa-solid fa-robot text-sky-500"></i>'},draggable:!1})}),e.jsxs("div",{className:`max-w-xs md:max-w-sm lg:max-w-xs px-4 py-2.5 ${r?"bg-slate-800/60 border border-slate-700 text-slate-200 rounded-lg":"bg-sky-800/60 border border-sky-700 text-white rounded-lg"}`,children:[e.jsx("p",{className:"text-sm leading-relaxed",children:a.content}),a.suggestedCandidates&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-600 space-y-2",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-400",children:"Ứng viên liên quan:"}),a.suggestedCandidates.map(i=>{var d,E;return e.jsxs("div",{className:"bg-slate-700/50 p-2 rounded-lg text-xs",children:[e.jsx("p",{className:"font-bold text-white",children:i.candidateName}),e.jsxs("p",{className:"text-slate-300",children:["Hạng: ",(d=i.analysis)==null?void 0:d.Hạng," - Điểm: ",(E=i.analysis)==null?void 0:E["Tổng điểm"]]})]},i.id)})]})]})]})};return e.jsxs("div",{className:"bg-slate-800/70 border border-slate-700 rounded-2xl shadow-lg flex flex-col h-96 max-h-[70vh] z-50",children:[e.jsxs("header",{className:"p-4 border-b border-slate-700 flex-shrink-0 flex items-center justify-between",children:[e.jsxs("h3",{className:"font-bold text-lg text-white flex items-center gap-2",children:[e.jsx("i",{className:"fa-solid fa-brain text-sky-500"}),"Trợ lý Tuyển dụng AI"]}),h&&e.jsx("button",{onClick:h,className:"text-slate-400 hover:text-white transition-colors","aria-label":"Đóng chatbot",children:e.jsx("i",{className:"fa-solid fa-times"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-5",children:[c.map(a=>e.jsx(k,{message:a},a.id)),l&&e.jsxs("div",{className:"flex justify-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-slate-600 bg-slate-700 flex items-center justify-center flex-shrink-0",children:e.jsx("img",{src:"/images/logos/logo.jpg",alt:"Support HR Bot",className:"object-cover w-full h-full",onError:a=>{const r=a.currentTarget;r.style.display="none",r.parentElement.innerHTML='<i class="fa-solid fa-robot text-sky-500"></i>'},draggable:!1})}),e.jsxs("div",{className:"max-w-xs px-4 py-3 bg-slate-800/60 border border-slate-700 rounded-lg flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-0"}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-150"}),e.jsx("span",{className:"w-2 h-2 bg-slate-400 rounded-full animate-pulse delay-300"})]})]}),e.jsx("div",{ref:A})]}),e.jsxs("div",{className:"p-3 border-t border-slate-700 flex-shrink-0 bg-slate-800/50 rounded-b-2xl",children:[f&&c.length===1&&e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Gợi ý câu hỏi:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:F.map((a,r)=>e.jsx("button",{onClick:()=>S(a),className:"text-xs bg-slate-700 hover:bg-slate-600 text-slate-200 px-3 py-1.5 rounded-full transition-colors border border-slate-600",disabled:l,children:a},r))}),e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Câu hỏi phỏng vấn nhanh:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>S(`Gợi ý 5 câu hỏi phỏng vấn chính cho vị trí ${s.job.position}?`),className:"text-xs bg-purple-700 hover:bg-purple-600 text-purple-200 px-3 py-1.5 rounded-full transition-colors border border-purple-600",disabled:l,children:[e.jsx("i",{className:"fa-solid fa-question-circle mr-1"}),"Câu hỏi chung"]}),e.jsxs("button",{onClick:()=>S(`Câu hỏi kỹ thuật nào phù hợp để đánh giá ứng viên ${s.job.position}?`),className:"text-xs bg-green-700 hover:bg-green-600 text-green-200 px-3 py-1.5 rounded-full transition-colors border border-green-600",disabled:l,children:[e.jsx("i",{className:"fa-solid fa-cogs mr-1"}),"Kỹ thuật"]}),e.jsxs("button",{onClick:()=>S(`Tôi nên hỏi gì để phân biệt ứng viên giỏi và xuất sắc cho ${s.job.position}?`),className:"text-xs bg-orange-700 hover:bg-orange-600 text-orange-200 px-3 py-1.5 rounded-full transition-colors border border-orange-600",disabled:l,children:[e.jsx("i",{className:"fa-solid fa-balance-scale mr-1"}),"Phân biệt"]})]})]}),e.jsxs("form",{onSubmit:$,className:"flex gap-2",children:[e.jsx("input",{type:"text",value:j,onChange:a=>x(a.target.value),placeholder:"Hỏi AI về ứng viên...",className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg px-4 py-2.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-sky-600 transition-colors disabled:opacity-50",disabled:l}),e.jsx("button",{type:"submit",disabled:l||!j.trim(),className:"w-10 h-10 flex items-center justify-center bg-sky-700 text-white rounded-lg hover:bg-sky-600 transition-colors disabled:bg-slate-600 disabled:cursor-not-allowed flex-shrink-0",children:l?e.jsx("i",{className:"fa-solid fa-spinner fa-spin"}):e.jsx("i",{className:"fa-solid fa-paper-plane"})})]})]})]})},Me=({message:s})=>e.jsxs("div",{className:"flex justify-center items-center flex-col gap-6 text-center py-12 md:py-16",children:[e.jsxs("div",{className:"relative w-20 h-20",children:[e.jsx("div",{className:"absolute inset-0 border-4 border-blue-500/20 rounded-full"}),e.jsx("div",{className:"absolute inset-0 border-t-4 border-blue-500 rounded-full animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-6 h-6 bg-blue-500/20 rounded-full pulse-animation"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 font-semibold text-lg",children:s||"Đang phân tích CV với AI..."}),e.jsx("p",{className:"text-slate-500 text-sm mt-2",children:"Quá trình này có thể mất một chút thời gian để đảm bảo độ chính xác cao nhất."})]})]});se.memo(({candidate:s,index:h,isSelected:c,expandedCandidate:m,expandedCriteria:j,onSelect:x,onExpand:l,onToggleCriterion:g})=>{var F,S,$,k,a;const f=s.status==="FAILED"?"FAILED":((F=s.analysis)==null?void 0:F.Hạng)||"C",N=s.status==="FAILED"?0:((S=s.analysis)==null?void 0:S["Tổng điểm"])||0,A=s.status==="FAILED"?0:parseInt(((a=(k=($=s.analysis)==null?void 0:$["Chi tiết"])==null?void 0:k.find(r=>r["Tiêu chí"].startsWith("Phù hợp JD")))==null?void 0:a.Điểm.split("/")[0])||"0",10);return e.jsxs(se.Fragment,{children:[e.jsxs("tr",{className:`border-t border-slate-700/50 ${c?"bg-blue-500/10":"hover:bg-slate-700/30"} cursor-pointer`,onClick:r=>{r.target.type!=="checkbox"&&l(s.id)},children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:c,onChange:r=>{r.stopPropagation(),x(s.id,h)},className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:s.candidateName||"Chưa xác định"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${s.status==="FAILED"?"bg-slate-600 text-slate-400":f==="A"?"bg-emerald-600 text-emerald-400":f==="B"?"bg-blue-600 text-blue-400":"bg-red-600 text-red-400"}`,children:f})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:N}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-200",children:[A,"%"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:s.jobTitle||""}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{children:s.phone||"N/A"}),e.jsx("div",{className:"text-slate-400",children:s.email||"N/A"})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-200 flex items-center justify-between",children:[e.jsx("span",{children:s.fileName||""}),e.jsx("button",{onClick:r=>{r.stopPropagation(),l(s.id)},className:"text-blue-400 hover:text-blue-300 ml-2",children:e.jsx("i",{className:`fa-solid fa-chevron-down transition-transform duration-300 ${m===s.id?"rotate-180":""}`})})]})]}),m===s.id&&s.status!=="FAILED"&&s.analysis&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"bg-slate-900/40 border-t border-slate-700/50",children:e.jsx(ge,{candidate:s,expandedCriteria:j,onToggleCriterion:g})})})]})});const Ve=({isLoading:s,loadingMessage:h,results:c,jobPosition:m,locationRequirement:j,jdText:x,setActiveStep:l,markStepAsCompleted:g})=>{const[f,N]=I.useState("all"),[A,F]=I.useState("score"),[S,$]=I.useState(""),[k,a]=I.useState(""),[r,i]=I.useState(new Set),[d,E]=I.useState(null),[u,t]=I.useState(null),[T,D]=I.useState({}),[w,R]=I.useState(!1),M=I.useCallback(Ne(n=>a(n),300),[]),B=n=>{$(n),M(n)},P=(n,C,p=!1)=>{i(b=>{var y;const o=new Set(b);if(p&&d!==null){const v=Math.min(d,C),L=Math.max(d,C);for(let H=v;H<=L;H++){const V=(y=O[H])==null?void 0:y.id;V&&o.add(V)}}else o.has(n)?o.delete(n):o.add(n),E(C);return o})},q=()=>{const n=O.map(C=>C.id).filter(Boolean);i(C=>C.size===n.length?new Set:new Set(n))},z=n=>{i(C=>{const p=new Set(C);return p.delete(n),p})},Z=()=>{window.confirm("Bạn có chắc muốn bỏ chọn tất cả ứng viên?")&&i(new Set)},J=n=>{t(u===n?null:n)},G=(n,C)=>{D(p=>{var b;return{...p,[n]:{...p[n],[C]:!((b=p[n])!=null&&b[C])}}})},W=()=>{if(r.size===0)return;const n=O.filter(v=>r.has(v.id)),b="\uFEFF"+[["STT","HoTen","Hang","DiemTong","PhuHopJD%","ChucDanh","FileName","CandidateID"],...n.map((v,L)=>{var H,V,X,K,ce,de;return[(L+1).toString(),v.candidateName||"",v.status==="FAILED"?"FAILED":((H=v.analysis)==null?void 0:H.Hạng)||"C",v.status==="FAILED"?"0":((X=(V=v.analysis)==null?void 0:V["Tổng điểm"])==null?void 0:X.toString())||"0",v.status==="FAILED"?"0":parseInt(((de=(ce=(K=v.analysis)==null?void 0:K["Chi tiết"])==null?void 0:ce.find(pe=>pe["Tiêu chí"].startsWith("Phù hợp JD")))==null?void 0:de.Điểm.split("/")[0])||"0",10).toString(),v.jobTitle||"",v.fileName||"",v.id||""]})].map(v=>v.map(L=>`"${L.replace(/"/g,'""')}"`).join(",")).join(`
`),o=new Blob([b],{type:"text/csv;charset=utf-8;"}),y=document.createElement("a");y.href=URL.createObjectURL(o),y.download=`ung_vien_da_chon_${new Date().toISOString().split("T")[0]}.csv`,y.click()},_=I.useMemo(()=>{if(!c||c.length===0)return{total:0,countA:0,countB:0,countC:0};const n=c.filter(o=>o.status==="SUCCESS"&&o.analysis),C=n.filter(o=>{var y;return((y=o.analysis)==null?void 0:y.Hạng)==="A"}).length,p=n.filter(o=>{var y;return((y=o.analysis)==null?void 0:y.Hạng)==="B"}).length,b=c.length-C-p;return{total:n.length,countA:C,countB:p,countC:b}},[c]),U=I.useMemo(()=>!c||c.length===0?null:{timestamp:Date.now(),job:{position:m,locationRequirement:j||"Không có"},candidates:c.map((n,C)=>({...n,id:n.id||`candidate-${C}-${n.fileName}-${n.candidateName}`.replace(/[^a-zA-Z0-9]/g,"-")}))},[c,m,j]),Y=I.useMemo(()=>{if(!c||c.length===0)return[];const n={A:3,B:2,C:1,FAILED:0},C=c.map(p=>{var b,o,y,v;return{...p,jdFitScore:parseInt(((y=(o=(b=p.analysis)==null?void 0:b["Chi tiết"])==null?void 0:o.find(L=>L["Tiêu chí"].startsWith("Phù hợp JD")))==null?void 0:y.Điểm.split("/")[0])||"0",10),gradeValue:n[p.status==="FAILED"?"FAILED":((v=p.analysis)==null?void 0:v.Hạng)||"C"]}});return C.sort((p,b)=>{var v,L,H,V;const o=A==="score"?(((v=b.analysis)==null?void 0:v["Tổng điểm"])||0)-(((L=p.analysis)==null?void 0:L["Tổng điểm"])||0):b.jdFitScore-p.jdFitScore;if(o!==0)return o;const y=A==="score"?b.jdFitScore-p.jdFitScore:(((H=b.analysis)==null?void 0:H["Tổng điểm"])||0)-(((V=p.analysis)==null?void 0:V["Tổng điểm"])||0);return y!==0?y:b.gradeValue-p.gradeValue}),C.map((p,b)=>({...p,rank:b+1}))},[c,A]),O=I.useMemo(()=>{let n=Y;return k&&(n=n.filter(p=>{var b,o;return((b=p.candidateName)==null?void 0:b.toLowerCase().includes(k.toLowerCase()))||((o=p.jobTitle)==null?void 0:o.toLowerCase().includes(k.toLowerCase()))})),f!=="all"&&(n=n.filter(p=>{var b;return p.status==="FAILED"?f==="C":((b=p.analysis)==null?void 0:b.Hạng)===f})),n.filter((p,b,o)=>b===o.findIndex(y=>y.id===p.id))},[Y,f,k]);return s?e.jsx("section",{id:"module-analysis",className:"module-pane active w-full",children:e.jsx(Me,{message:h})}):c.length===0?e.jsx("section",{id:"module-analysis",className:"module-pane active w-full",children:e.jsxs("div",{className:"text-center py-16 md:py-20",children:[e.jsxs("div",{className:"relative inline-block mb-6",children:[e.jsx("i",{className:"fa-solid fa-chart-line text-5xl md:text-6xl text-slate-600 float-animation"}),e.jsx("div",{className:"absolute -top-2 -right-2 w-4 h-4 bg-blue-500 rounded-full pulse-animation"})]}),e.jsx("h3",{className:"text-2xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent mb-3",children:"Sẵn Sàng Phân Tích"}),e.jsx("p",{className:"text-slate-400 text-lg max-w-md mx-auto leading-relaxed",children:"Kết quả AI sẽ xuất hiện ở đây sau khi bạn cung cấp mô tả công việc và các tệp CV."})]})}):e.jsxs(e.Fragment,{children:[e.jsx("section",{id:"module-analysis",className:"module-pane active w-full",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-xl p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-slate-400",children:[e.jsxs("span",{className:"px-3 py-1 rounded-full bg-slate-700/60 border border-slate-600",children:["Tổng CV: ",_.total]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-slate-700/60 border border-slate-600",children:["A: ",_.countA]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-slate-700/60 border border-slate-600",children:["B: ",_.countB]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-slate-700/60 border border-slate-600",children:["C/Lỗi: ",_.countC]})]}),e.jsx("div",{children:e.jsxs("button",{onClick:()=>{l&&l("dashboard"),g&&g("analysis"),window.location.hash="#/detailed-analytics"},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white text-sm font-semibold rounded-full transition-all duration-200 shadow-lg",children:[e.jsx("i",{className:"fa-solid fa-chart-line"}),"Thống Kê Chi Tiết"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-slate-800/50 p-5 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Tổng CV Phân Tích"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-1",children:_.total})]}),e.jsxs("div",{className:"bg-slate-800/50 p-5 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Hạng A"}),e.jsx("p",{className:"text-3xl font-bold text-emerald-400 mt-1",children:_.countA})]}),e.jsxs("div",{className:"bg-slate-800/50 p-5 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Hạng B"}),e.jsx("p",{className:"text-3xl font-bold text-blue-400 mt-1",children:_.countB})]}),e.jsxs("div",{className:"bg-slate-800/50 p-5 rounded-xl border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Hạng C/Lỗi"}),e.jsx("p",{className:"text-3xl font-bold text-red-400 mt-1",children:_.countC})]})]}),e.jsx("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-auto flex-grow sm:flex-grow-0",children:[e.jsx("i",{className:"fa-solid fa-magnifying-glass text-slate-500 absolute left-4 top-1/2 -translate-y-1/2"}),e.jsx("input",{type:"text",placeholder:"Tìm theo tên, chức danh...",value:S,onChange:n=>B(n.target.value),className:"w-full sm:w-64 pl-11 pr-4 py-2.5 bg-slate-900/70 border border-slate-600 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-slate-900/50 p-1 rounded-full",children:[e.jsx("button",{onClick:()=>N("all"),className:`px-4 py-1.5 text-sm font-semibold rounded-full transition-colors ${f==="all"?"bg-blue-600 text-white":"text-slate-300 hover:bg-slate-700"}`,children:"Tất cả"}),e.jsx("button",{onClick:()=>N("A"),className:`px-4 py-1.5 text-sm font-semibold rounded-full transition-colors ${f==="A"?"bg-emerald-500 text-white":"text-slate-300 hover:bg-slate-700"}`,children:"Hạng A"}),e.jsx("button",{onClick:()=>N("B"),className:`px-4 py-1.5 text-sm font-semibold rounded-full transition-colors ${f==="B"?"bg-blue-500 text-white":"text-slate-300 hover:bg-slate-700"}`,children:"Hạng B"}),e.jsx("button",{onClick:()=>N("C"),className:`px-4 py-1.5 text-sm font-semibold rounded-full transition-colors ${f==="C"?"bg-red-500 text-white":"text-slate-300 hover:bg-slate-700"}`,children:"Hạng C"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"sort-by",className:"text-sm font-medium text-slate-400",children:"Sắp xếp:"}),e.jsxs("select",{id:"sort-by",value:A,onChange:n=>F(n.target.value),className:"bg-slate-700/80 border-slate-600 text-slate-200 text-sm font-semibold rounded-full py-2 pl-4 pr-8 focus:ring-2 focus:ring-blue-500 focus:outline-none appearance-none",children:[e.jsx("option",{value:"score",children:"Điểm Tổng"}),e.jsx("option",{value:"jdFit",children:"Phù hợp JD"})]})]})]})}),e.jsx("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700 overflow-hidden",children:e.jsx("div",{className:"max-h-[70vh] overflow-y-auto results-container",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-700/50 sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left",children:e.jsx("input",{type:"checkbox",checked:r.size===O.length&&O.length>0,onChange:q,className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"})}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-300",children:"Họ tên"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-300",children:"Hạng"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-300",children:"Điểm"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-300",children:"Phù hợp JD"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-300",children:"Liên hệ"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-slate-300",children:"File"})]})}),e.jsxs("tbody",{children:[O.map((n,C)=>{var v,L,H,V,X;const p=r.has(n.id),b=n.status==="FAILED"?"FAILED":((v=n.analysis)==null?void 0:v.Hạng)||"C",o=n.status==="FAILED"?0:((L=n.analysis)==null?void 0:L["Tổng điểm"])||0,y=n.status==="FAILED"?0:parseInt(((X=(V=(H=n.analysis)==null?void 0:H["Chi tiết"])==null?void 0:V.find(K=>K["Tiêu chí"].startsWith("Phù hợp JD")))==null?void 0:X.Điểm.split("/")[0])||"0",10);return e.jsxs(se.Fragment,{children:[e.jsxs("tr",{className:`border-t border-slate-700/50 ${p?"bg-blue-500/10":"hover:bg-slate-700/30"} cursor-pointer transition-colors duration-150`,onClick:K=>{K.target.type!=="checkbox"&&J(n.id)},children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("input",{type:"checkbox",checked:p,onChange:K=>{K.stopPropagation(),P(n.id,C)},className:"rounded border-slate-600 bg-slate-800 text-blue-500 focus:ring-blue-500"})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:n.candidateName||"Chưa xác định"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${n.status==="FAILED"?"bg-slate-600 text-slate-400":b==="A"?"bg-emerald-600 text-emerald-400":b==="B"?"bg-blue-600 text-blue-400":"bg-red-600 text-red-400"}`,children:b})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:o}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-200",children:[y,"%"]}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-200",children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{children:n.phone||"N/A"}),e.jsx("div",{className:"text-slate-400",children:n.email||"N/A"})]})}),e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-200 flex items-center justify-between",children:[e.jsx("span",{children:n.fileName||""}),e.jsx("button",{onClick:K=>{K.stopPropagation(),J(n.id)},className:"text-blue-400 hover:text-blue-300 ml-2 transition-colors duration-150",children:e.jsx("i",{className:`fa-solid fa-chevron-down transition-transform duration-300 ${u===n.id?"rotate-180":""}`})})]})]}),u===n.id&&n.status!=="FAILED"&&n.analysis&&e.jsx("tr",{className:"expanded-content",children:e.jsx("td",{colSpan:7,className:"bg-slate-900/40 border-t border-slate-700/50",children:e.jsx(ge,{candidate:n,expandedCriteria:T,onToggleCriterion:G,jdText:x})})})]},n.id)}),O.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-4 py-12 text-center text-slate-500",children:[e.jsx("i",{className:"fa-solid fa-ghost text-4xl mb-4"}),e.jsx("p",{children:"Không có ứng viên nào khớp với bộ lọc của bạn."})]})})]})]})})}),r.size>0&&e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-200",children:["Ứng viên đã chọn (",r.size,")"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:W,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-500 text-white text-sm font-semibold rounded-full transition-colors",children:[e.jsx("i",{className:"fa-solid fa-file-csv"}),"Xuất CSV đã chọn"]}),e.jsxs("button",{onClick:Z,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-500 text-white text-sm font-semibold rounded-full transition-colors",children:[e.jsx("i",{className:"fa-solid fa-trash"}),"Xoá tất cả"]})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:O.filter(n=>r.has(n.id)).map(n=>{var o,y,v,L,H;const C=n.status==="FAILED"?"FAILED":((o=n.analysis)==null?void 0:o.Hạng)||"C",p=n.status==="FAILED"?0:((y=n.analysis)==null?void 0:y["Tổng điểm"])||0,b=n.status==="FAILED"?0:parseInt(((H=(L=(v=n.analysis)==null?void 0:v["Chi tiết"])==null?void 0:L.find(V=>V["Tiêu chí"].startsWith("Phù hợp JD")))==null?void 0:H.Điểm.split("/")[0])||"0",10);return e.jsxs("div",{className:"flex items-center justify-between bg-slate-700/50 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-sm text-slate-400",children:n.candidateName||"Chưa xác định"}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${n.status==="FAILED"?"bg-slate-600 text-slate-400":C==="A"?"bg-emerald-600 text-emerald-400":C==="B"?"bg-blue-600 text-blue-400":"bg-red-600 text-red-400"}`,children:C}),e.jsxs("span",{className:"text-sm text-slate-400",children:[p," / ",b,"%"]}),e.jsx("span",{className:"text-sm text-slate-500",children:n.jobTitle||""})]}),e.jsx("button",{onClick:()=>z(n.id),className:"text-red-400 hover:text-red-300 text-sm underline",children:"Bỏ chọn"})]},n.id)})})]})]})}),U&&e.jsx("button",{onClick:()=>R(!w),className:"fixed bottom-6 right-6 w-14 h-14 bg-gradient-to-r from-blue-600 to-sky-500 hover:from-blue-500 hover:to-sky-400 text-white rounded-full shadow-lg flex items-center justify-center transition-all duration-200 z-50 hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-500/40","aria-label":"Mở trợ lý AI",title:"Trợ lý AI - Hỏi về ứng viên",children:e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden border border-white/20 bg-white/10 flex items-center justify-center",children:e.jsx("img",{src:"/images/logos/logo.jpg",alt:"Support HR AI",className:"object-cover w-full h-full",onError:n=>{const C=n.currentTarget;C.style.display="none",C.parentElement.innerHTML='<i class="fa-solid fa-brain text-white text-lg"></i>'},draggable:!1})})}),w&&U&&e.jsx("div",{className:"fixed bottom-20 right-6 w-96 max-w-[calc(100vw-2rem)] z-40",children:e.jsx(He,{analysisData:U,onClose:()=>R(!1)})})]})};export{Ve as default};
